<!-- Updated: 2025-02-13 | Sprint: - | Tasks: - -->

# Система задач и спринтов

## Краткое описание

Централизованная система управления задачами, где все задачи привязаны к спринтам и проходят через три этапа: детализация → разработка → тестирование.

## Пользовательская ценность

**Как** руководитель проекта (boss),
**я хочу** создавать задачи с назначением трёх исполнителей,
**чтобы** обеспечить качественную проработку требований, реализацию и проверку.

## Основные сценарии использования

### Сценарий 1: Создание спринта

1. Boss запускает команду `task_manager.py create-sprint "Название" "Описание"`
2. Система создаёт спринт с уникальным ID (S001, S002, ...)
3. Автоматически создаётся задача "Финализировать спринт"
4. Создаётся git-ветка `sprint/S001`

### Сценарий 2: Создание задачи

1. Boss запускает `task_manager.py create "Заголовок" "Описание" --customer analyst --developer developer --tester tester --sprint S001`
2. Система создаёт задачу с уникальным ID (T001, T002, ...)
3. Задача появляется в статусе `новая`
4. В оркестраторе задача отображается в канбан-доске спринта

### Сценарий 3: Прохождение задачи через этапы

```
[новая]
    ↓ постановщик детализирует, пишет в discussions/
    ↓ result: "Детализировано. См. discussions/T001.md"
    ↓ status: в_работе
[в_работе]
    ↓ разработчик реализует, дописывает в discussions/
    ↓ result: "Выполнено. См. discussions/T001.md"
    ↓ status: на_проверке
    ↓ → автоматический git commit
[на_проверке]
    ↓ тестировщик проверяет, дописывает результат
    ↓ ✅ result: "Принято" → status: выполнена
    ↓ ❌ result: "Возврат" → status: в_работе
[выполнена]
```

### Сценарий 4: Финализация спринта

1. Все задачи спринта в статусе `выполнена` или `отменена`
2. Boss переводит задачу "Финализировать спринт" в `выполнена`
3. Система выполняет merge `sprint/S001` → `main`
4. Создаётся версионный тег (v0.1.0, v0.2.0, ...)
5. Push в remote
6. Спринт архивируется

## Ключевое поведение

| Ситуация | Поведение системы |
|----------|-------------------|
| Создание спринта | Автосоздание задачи "Финализировать" с зависимостями от всех задач |
| Смена статуса на `на_проверке` | Автоматический git commit |
| Финализация спринта | Merge + tag + push |
| Задача с зависимостями | Не может начаться, пока зависимости не выполнены |

## Статусы задач

| Статус | Описание | Кто работает |
|--------|----------|--------------|
| `новая` | Задача создана | Постановщик (customer) |
| `в_работе` | Требования детализированы | Разработчик (developer) |
| `на_проверке` | Реализация завершена | Тестировщик (tester) |
| `выполнена` | Проверка пройдена | — |
| `отменена` | Задача отменена | — |

## Роли в задаче

| Роль | Что делает | Типичные агенты |
|------|-----------|-----------------|
| **Постановщик (customer)** | Детализирует требования, пишет acceptance criteria | analyst, product_manager |
| **Разработчик (developer)** | Реализует функционал | developer_python, developer_frontend |
| **Тестировщик (tester)** | Проверяет качество | qa_tester, tester |

## Ограничения и особенности

- Все задачи должны быть привязаны к спринту
- Boss не ставит себя постановщиком в обычных задачах
- JSON-файл `tasks.json` редактируется только через `task_manager.py`
- Зависимости блокируют выполнение задачи

## Связанные компоненты

- `.tayfa/common/task_manager.py` — CLI управления задачами
- `.tayfa/common/tasks.json` — хранилище задач
- `kok/app.py` — оркестратор (Web UI)
- `.tayfa/common/discussions/` — обсуждения по задачам

## CLI команды

```bash
# Спринты
python .tayfa/common/task_manager.py create-sprint "Название" "Описание"
python .tayfa/common/task_manager.py sprints
python .tayfa/common/task_manager.py sprint S001

# Задачи
python .tayfa/common/task_manager.py create "Заголовок" "Описание" \
  --customer analyst --developer developer --tester tester --sprint S001
python .tayfa/common/task_manager.py list
python .tayfa/common/task_manager.py list --status в_работе
python .tayfa/common/task_manager.py list --sprint S001
python .tayfa/common/task_manager.py get T001

# Работа с задачей
python .tayfa/common/task_manager.py result T001 "Описание результата"
python .tayfa/common/task_manager.py status T001 в_работе
```

## История изменений

| Дата | Спринт | Что изменилось |
|------|--------|----------------|
| 2025-02-13 | - | Первоначальная версия документации |
