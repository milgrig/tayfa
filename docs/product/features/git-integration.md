<!-- Updated: 2025-02-13 | Sprint: - | Tasks: - -->

# Git интеграция

## Краткое описание

Автоматическая интеграция с Git: создание веток для спринтов, коммиты при смене статуса задач, merge и теги при финализации.

## Пользовательская ценность

**Как** агент,
**я хочу** не думать о git-командах,
**чтобы** сосредоточиться на выполнении задачи.

**Как** пользователь (человек),
**я хочу** автоматически получать историю изменений с версиями,
**чтобы** отслеживать прогресс проекта.

## Основные сценарии использования

### Сценарий 1: Создание спринта

1. Boss создаёт спринт через `task_manager.py create-sprint`
2. Система автоматически создаёт ветку `sprint/S001`
3. Все изменения в спринте идут в эту ветку

### Сценарий 2: Автоматический коммит

1. Разработчик переводит задачу в `на_проверке`
2. Оркестратор выполняет `git add -A`
3. Оркестратор выполняет `git commit -m "T001: Заголовок задачи"`
4. Изменения зафиксированы

### Сценарий 3: Финализация спринта

1. Все задачи спринта выполнены
2. Boss переводит "Финализировать спринт" в `выполнена`
3. Система выполняет:
   - `git checkout main`
   - `git merge sprint/S001`
   - `git tag v0.1.0`
   - `git push origin main --tags`
4. Спринт релизнут

## Ключевое поведение

| Событие | Действие Git |
|---------|--------------|
| Создание спринта | `git checkout -b sprint/S001` |
| Задача → `на_проверке` | `git add -A && git commit -m "T001: ..."` |
| Финализация спринта | Merge в main + tag + push |

## Структура веток

```
main (стабильная версия)
  │
  ├── sprint/S001
  │     ├── коммит: T001 — Заголовок
  │     ├── коммит: T002 — Заголовок
  │     └── финализация → merge + tag v0.1.0
  │
  ├── sprint/S002
  │     └── ... → merge + tag v0.2.0
  │
  └── sprint/S003 (активный)
```

## Версионирование

Используется Semantic Versioning (SemVer):

| Изменение | Версия |
|-----------|--------|
| Начальная | v0.1.0 |
| Minor (новая фича) | v0.2.0 |
| Patch (багфикс) | v0.2.1 |
| Major (breaking changes) | v1.0.0 |

При финализации спринта версия инкрементируется автоматически (minor по умолчанию).

## Правила для агентов

**Агенты НЕ выполняют git-команды.** Они только:
1. Выполняют работу по задаче
2. Записывают результат через `task_manager.py result`
3. Меняют статус через `task_manager.py status`

Git-операции выполняет оркестратор автоматически.

## Ограничения и особенности

- Требуется настроенный git (user.name, user.email)
- GitHub token в `settings.json` для push
- Merge конфликты не обрабатываются автоматически
- Нет retry при сетевых ошибках

## Связанные компоненты

- `kok/git_manager.py` — все git-операции
- `kok/app.py` — триггеры в оркестраторе
- `.tayfa/common/task_manager.py` — вызывает git при смене статуса

## История изменений

| Дата | Спринт | Что изменилось |
|------|--------|----------------|
| 2025-02-13 | - | Первоначальная версия документации |
