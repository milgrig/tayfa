<!-- Updated: 2025-02-13 | Sprint: - | Tasks: - -->

# Система обсуждений (Discussions)

## Краткое описание

Централизованное место для коммуникации агентов по каждой задаче. Каждая задача имеет свой файл обсуждения, где сохраняется вся история передачи (handoff) между этапами.

## Пользовательская ценность

**Как** агент (постановщик/разработчик/тестировщик),
**я хочу** видеть полную историю работы над задачей,
**чтобы** понимать контекст и не терять информацию при передаче.

**Как** пользователь (человек),
**я хочу** читать историю обсуждений в простом формате,
**чтобы** понимать, что происходило с задачей.

## Основные сценарии использования

### Сценарий 1: Постановщик создаёт обсуждение

1. Постановщик получает задачу в статусе `новая`
2. Создаёт файл `.tayfa/common/discussions/T001.md`
3. Пишет детализацию: acceptance criteria, test cases
4. Записывает краткий статус в task_manager
5. Переводит задачу в `в_работе`

### Сценарий 2: Разработчик дописывает результат

1. Разработчик читает файл `discussions/T001.md`
2. Видит детализацию от постановщика
3. Выполняет работу
4. Дописывает свой результат в конец файла
5. Переводит задачу в `на_проверке`

### Сценарий 3: Тестировщик завершает цикл

1. Тестировщик читает весь файл `discussions/T001.md`
2. Видит: детализацию + результат разработчика
3. Проверяет по чек-листу
4. Дописывает результат тестирования
5. Переводит в `выполнена` или возвращает в `в_работе`

## Ключевое поведение

| Ситуация | Поведение |
|----------|-----------|
| Первый агент (постановщик) | Создаёт файл с заголовком задачи |
| Последующие агенты | Дописывают в конец, не удаляя предыдущее |
| task_manager.py result | Содержит только краткий статус со ссылкой на файл |

## Формат файла обсуждения

```markdown
# T001: Заголовок задачи

---

## [2025-01-15 10:00] analyst (постановщик)

### Детализация задачи

#### Что нужно сделать
...

#### Acceptance Criteria
- [ ] Критерий 1
- [ ] Критерий 2

#### Test Cases
1. Действие → Результат

---

## [2025-01-15 14:00] developer (разработчик)

### Результат выполнения

#### Что сделано
- ...

#### Изменённые файлы
- `path/to/file.py` — описание

#### Чек-лист для тестировщика
- [ ] Проверить критерий 1

---

## [2025-01-15 16:00] tester (тестировщик)

### Результат тестирования: ✅ ПРИНЯТО

#### Проверенные критерии
- [✓] Критерий 1: проверено
- [✓] Критерий 2: проверено
```

## Обязательные форматы Handoff

### Постановщик → Разработчик

- Что нужно сделать
- Acceptance Criteria (измеримые)
- Test Cases (happy path + edge cases)
- Технические детали (опционально)

### Разработчик → Тестировщик

- Что сделано
- Изменённые файлы
- Как проверить (команды, URL)
- Чек-лист для тестировщика

### Тестировщик → Завершение/Возврат

- Статус по каждому критерию
- Найденные баги (если есть)
- Шаги воспроизведения багов

## Ограничения и особенности

- Файлы только дописываются, не перезаписываются
- Разделитель между сообщениями: `---`
- Формат заголовка: `## [дата время] имя_агента (роль)`
- В task_manager.py result пишется только краткий статус

## Связанные компоненты

- `.tayfa/common/discussions/` — папка с файлами обсуждений
- `.tayfa/common/task_manager.py` — записывает краткий статус
- Промпты агентов — содержат форматы handoff

## История изменений

| Дата | Спринт | Что изменилось |
|------|--------|----------------|
| 2025-02-13 | - | Первоначальная версия. Заменена система income/done |
