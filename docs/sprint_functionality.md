# Спринт: Описание функциональности Tayfa

**Дата**: 2026-02-11
**Версия**: 1.0
**Автор**: architect

---

## 1. Описание проекта

**Tayfa Orchestrator** — веб-приложение для управления мультиагентной системой на базе Claude API.

### Основные возможности:
- 🤖 **Управление AI-агентами** — создание, запуск, остановка агентов (Claude API + Cursor CLI)
- 📋 **Система задач и спринтов** — трекинг задач с ролями (заказчик, разработчик, тестировщик)
- 👥 **Управление командой** — реестр сотрудников (агентов) с ролями
- 📁 **Мультипроектность** — работа с несколькими проектами, каждый со своей .tayfa папкой
- ⚙️ **Настройки** — темы оформления (dark/light/blue), порт сервера и др.
- 🌐 **Веб-интерфейс** — SPA на чистом HTML/CSS/JS

### Технический стек:
- **Backend**: Python 3.11+, FastAPI, uvicorn
- **Frontend**: HTML5, CSS3 (CSS Variables), Vanilla JS
- **AI Runtime**: Claude API (через WSL), Cursor CLI
- **Хранение данных**: JSON-файлы (tasks.json, employees.json, projects.json, settings.json)

---

## 2. Структура файлов и папок

### 2.1 Корневые файлы приложения (`project/kok/`)

| Файл | Описание | Назначение |
|------|----------|------------|
| `app.py` | **Главный файл** | FastAPI-сервер, API эндпоинты, интеграция с Claude/Cursor |
| `settings_manager.py` | Менеджер настроек | Загрузка/сохранение/валидация settings.json |
| `project_manager.py` | Менеджер проектов | Мультипроектность, .tayfa инициализация |
| `settings.json` | Конфигурация | Настройки приложения (тема, порт, язык) |
| `projects.json` | Список проектов | Пути, имена, текущий проект |
| `tayfa.bat` | Точка входа | Windows-скрипт запуска (venv + uvicorn) |

### 2.2 Статические файлы (`project/kok/static/`)

| Файл | Размер | Описание |
|------|--------|----------|
| `index.html` | 106 KB | Главная страница SPA (HTML + CSS + JS) |
| `favicon.svg` | 0.4 KB | SVG-иконка для браузера |
| `tayfa-icon.ico` | 87 KB | ICO-иконка для ярлыка |
| `tayfa-icon.png` | 4.6 MB | PNG-иконка высокого разрешения |

### 2.3 Шаблон для новых проектов (`project/kok/template_tayfa/`)

При инициализации проекта эта структура копируется в `<project>/.tayfa/`:

```
template_tayfa/
├── config.json          # Базовая конфигурация
├── boss/
│   ├── prompt.md        # Системный промпт boss
│   ├── profile.md       # Профиль с навыками
│   ├── notes.md         # Заметки
│   ├── income/          # Входящие задания
│   └── done/            # Выполненные
├── hr/
│   ├── prompt.md        # Системный промпт HR
│   ├── profile.md       # Профиль
│   ├── create_employee.py # Скрипт создания сотрудников
│   ├── Income/          # Входящие
│   └── done/            # Выполненные
└── common/
    ├── employees.json   # Реестр сотрудников
    ├── tasks.json       # Задачи и спринты
    ├── employee_manager.py # API управления сотрудниками
    ├── task_manager.py  # API управления задачами
    └── Rules/
        ├── employees.md # Правила взаимодействия
        └── teamwork.md  # Правила командной работы
```

### 2.4 Общие файлы системы (`common/`)

| Файл | Описание |
|------|----------|
| `employees.json` | Реестр сотрудников (активные агенты системы) |
| `tasks.json` | Задачи и спринты (основная БД) |
| `employee_manager.py` | CLI/API управления сотрудниками |
| `task_manager.py` | CLI/API управления задачами и спринтами |
| `memory_manager.py` | Управление памятью агентов |

### 2.5 Правила (`common/Rules/`)

| Файл | Описание |
|------|----------|
| `api.md` | Правила работы с API |
| `teamwork.md` | Правила командной работы агентов |
| `employees.md` | Описания сотрудников и когда к ним обращаться |
| `skills.md` | Правила использования skills |
| `agents-and-skills-guide.md` | Гайд по агентам и навыкам |
| `cursor-cli-agents.md` | Работа с Cursor CLI |

### 2.6 Навыки (`common/skills/`)

```
skills/
├── project-decomposer/   # Навык декомпозиции проектов
│   ├── SKILL.md          # Инструкции навыка
│   ├── README.md         # Документация
│   ├── QUICKSTART.md     # Быстрый старт
│   ├── evals/            # Тесты навыка
│   ├── examples/         # Примеры использования
│   └── templates/        # Шаблоны
└── team-role-analyzer/   # Навык анализа ролей в команде
    ├── SKILL.md
    ├── README.md
    ├── QUICKSTART.md
    ├── evals/
    ├── examples/
    └── templates/
```

### 2.7 Папки агентов

Каждый агент имеет свою папку со структурой:
```
<agent_name>/
├── prompt.md       # Системный промпт агента
├── profile.md      # Профиль с навыками
├── source.md       # Исходные данные/контекст
├── tasks.md        # Личные заметки о задачах
├── notes.md        # Рабочие заметки
├── memory.json     # Память агента (опционально)
├── income/         # Входящие задания
├── done/           # Выполненные задания
└── request/        # Исходящие запросы
```

Текущие агенты:
- `architect/` — Системный архитектор
- `boss/` — Руководитель
- `developer_backend/` — Backend-разработчик
- `developer_frontend/` — Frontend-разработчик
- `devops/` — DevOps-инженер
- `hr/` — HR-менеджер
- `qa_tester/` — QA-тестировщик

---

## 3. API Эндпоинты

### 3.1 Статус и управление сервером
| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/status` | Статус системы (WSL, API, текущий проект) |
| POST | `/api/start-server` | Запустить Claude API сервер |
| POST | `/api/stop-server` | Остановить Claude API сервер |

### 3.2 Агенты
| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/agents` | Список агентов |
| POST | `/api/create-agent` | Создать агента |
| POST | `/api/send-prompt` | Отправить промпт (Claude API) |
| POST | `/api/send-prompt-cursor` | Отправить промпт (Cursor CLI) |
| POST | `/api/reset-agent` | Сбросить память агента |
| DELETE | `/api/agents/{name}` | Удалить агента |
| POST | `/api/ensure-agents` | Создать агентов для всех сотрудников |
| POST | `/api/refresh-agent-prompt/{name}` | Обновить промпт агента |

### 3.3 Cursor CLI
| Метод | Путь | Описание |
|-------|------|----------|
| POST | `/api/cursor-create-chat` | Создать чат для агента |
| POST | `/api/cursor-create-chats` | Создать чаты для всех агентов |
| GET | `/api/cursor-chats` | Список привязок агент → chat_id |

### 3.4 Проекты
| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/projects` | Список проектов |
| GET | `/api/current-project` | Текущий проект |
| POST | `/api/projects/open` | Открыть проект (init + set_current) |
| POST | `/api/projects/init` | Инициализировать .tayfa |
| POST | `/api/projects/add` | Добавить в список |
| POST | `/api/projects/remove` | Удалить из списка |

### 3.5 Настройки
| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/settings` | Получить настройки |
| POST | `/api/settings` | Обновить настройки |

### 3.6 Сотрудники
| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/employees` | Список сотрудников |
| GET | `/api/employees/{name}` | Данные сотрудника |
| POST | `/api/employees` | Зарегистрировать сотрудника |
| DELETE | `/api/employees/{name}` | Удалить сотрудника |

### 3.7 Задачи и спринты
| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/tasks-list` | Список задач |
| GET | `/api/tasks-list/{id}` | Получить задачу |
| POST | `/api/tasks-list` | Создать задачу/бэклог |
| PUT | `/api/tasks-list/{id}/status` | Изменить статус |
| PUT | `/api/tasks-list/{id}/result` | Записать результат |
| POST | `/api/tasks-list/{id}/trigger` | Запустить агента для задачи |
| GET | `/api/running-tasks` | Текущие выполняемые задачи |
| GET | `/api/sprints` | Список спринтов |
| GET | `/api/sprints/{id}` | Получить спринт |
| POST | `/api/sprints` | Создать спринт |
| PUT | `/api/sprints/{id}/status` | Изменить статус спринта |

---

## 4. Список лишних файлов

### 4.1 Кандидаты на удаление

| Файл/Папка | Причина | Рекомендация |
|------------|---------|--------------|
| `project/kok/venv/` | Виртуальное окружение | **НЕ коммитить в git** (.gitignore) |
| `project/kok/logs/` | Логи выполнения | **НЕ коммитить** (.gitignore) |
| `project/kok/logs/executed_requests.jsonl` | Лог запросов | Очищать периодически |
| `*/__pycache__/` | Python кэш | **НЕ коммитить** (.gitignore) |
| `project/kok/template_tayfa/*/__pycache__/` | Кэш в шаблоне | Удалить |
| `project/kok/static/tayfa-icon.png` | 4.6 MB | Слишком большой, оптимизировать |

### 4.2 Вспомогательные скрипты (можно оставить)

| Файл | Статус | Примечание |
|------|--------|------------|
| `cursor_create_chat.py` | ⚠️ Дублирует | Функционал в app.py |
| `cursor_send.py` | ⚠️ Дублирует | Функционал в app.py |
| `kill_all_agents.bat` | ⚠️ Устарел | Использует порт 8000 (сейчас 8008) |

### 4.3 Рекомендуемый .gitignore

```gitignore
# Python
__pycache__/
*.pyc
*.pyo
venv/

# Logs
logs/
*.log
*.jsonl

# Временные файлы
.cursor_cli_prompt.txt
.cursor_chats.json

# IDE
.idea/
.vscode/
*.swp

# OS
.DS_Store
Thumbs.db
```

---

## 5. Статистика проекта

| Метрика | Значение |
|---------|----------|
| Файлов кода | ~25 |
| Строк Python | ~3000+ |
| Строк HTML/CSS/JS | ~2300 |
| Агентов | 7 |
| API эндпоинтов | ~30 |
| Завершённых спринтов | 3 |
| Завершённых задач | 15 |

---

## 6. Архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│                        Web Browser                               │
│                      (index.html SPA)                            │
└─────────────────────────┬───────────────────────────────────────┘
                          │ HTTP (port 8008)
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Tayfa Orchestrator                            │
│                        (app.py)                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │ FastAPI      │  │ Settings     │  │ Project Manager      │   │
│  │ REST API     │  │ Manager      │  │ (мультипроектность)  │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
└─────────────────────────┬───────────────────────────────────────┘
                          │
        ┌─────────────────┴─────────────────┐
        │                                   │
        ▼                                   ▼
┌───────────────────────┐         ┌───────────────────────┐
│     Claude API        │         │     Cursor CLI        │
│   (localhost:8788)    │         │   (WSL + agent)       │
│                       │         │                       │
│  Управление агентами, │         │  Альтернативный       │
│  отправка промптов    │         │  runtime для агентов  │
└───────────────────────┘         └───────────────────────┘
        │                                   │
        └─────────────────┬─────────────────┘
                          │
                          ▼
        ┌─────────────────────────────────────────┐
        │            Файловая система             │
        │  ┌──────────────────────────────────┐   │
        │  │  .tayfa/ (папка проекта)         │   │
        │  │  ├── tasks.json                  │   │
        │  │  ├── employees.json              │   │
        │  │  ├── boss/, hr/, <agents>/       │   │
        │  │  └── common/Rules/               │   │
        │  └──────────────────────────────────┘   │
        └─────────────────────────────────────────┘
```

---

## 7. Следующие шаги

1. **Оптимизация**: уменьшить размер tayfa-icon.png
2. **Очистка**: удалить __pycache__ из template_tayfa
3. **Рефакторинг**: удалить дублирующиеся cursor_*.py скрипты
4. **Исправление**: обновить порт в kill_all_agents.bat (8000 → 8008)
5. **Документация**: добавить README.md в корень project/kok/
