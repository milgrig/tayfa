# Карта файлов и папок проекта Tayfa

**Версия**: 1.0
**Дата**: 2026-02-11
**Автор**: architect (задача T021)

---

## 1. Обзорная диаграмма структуры

```
Tayfa_2/
├── kok/                          # Оркестратор (копия для разработки)
│   ├── app.py                    # Главное приложение
│   ├── cursor_*.py               # Интеграция с Cursor
│   ├── static/                   # Веб-ресурсы
│   ├── template_tayfa/           # Шаблон (пустой, устаревший)
│   ├── logs/                     # Логи
│   └── venv/                     # Виртуальное окружение
│
└── Personel/                     # Команда агентов (основная рабочая директория)
    ├── common/                   # Общие ресурсы
    │   ├── Rules/                # Правила работы
    │   ├── skills/               # Навыки агентов
    │   ├── task_manager.py       # Управление задачами
    │   ├── employee_manager.py   # Управление сотрудниками
    │   └── *.json                # Данные (tasks, employees)
    │
    ├── boss/                     # Руководитель
    ├── hr/                       # HR-менеджер
    ├── architect/                # Системный архитектор
    ├── developer_frontend/       # Frontend-разработчик
    ├── developer_backend/        # Backend-разработчик
    ├── devops/                   # DevOps-инженер
    ├── qa_tester/                # QA-тестировщик
    │
    ├── Request/                  # Входящие запросы на создание агентов
    │
    └── project/                  # Рабочий проект
        ├── kok/                  # Копия оркестратора (актуальная версия!)
        └── docs/                 # Документация проекта
```

---

## 2. Директория ../kok/ — Оркестратор (внешняя копия)

> **Примечание**: Это резервная/разработческая копия. Актуальная версия находится в `Personel/project/kok/`.

### 2.1 Основные файлы

| Файл | Размер | Назначение |
|------|--------|------------|
| `app.py` | 49 KB | Главное приложение: FastAPI-сервер, API эндпоинты, интеграция с Claude API и Cursor CLI |
| `README.md` | 10 KB | Документация оркестратора |
| `requirements.txt` | 50 B | Зависимости Python (fastapi, uvicorn, httpx, pydantic) |

### 2.2 Интеграция с Cursor

| Файл | Назначение |
|------|------------|
| `cursor_create_chat.py` | Создание чата для агента через Cursor CLI |
| `cursor_send.py` | Отправка промпта агенту через Cursor CLI |

### 2.3 Скрипты запуска и управления

| Файл | Назначение |
|------|------------|
| `tayfa.bat` | Windows-скрипт запуска (создаёт venv, устанавливает зависимости, запускает uvicorn) |
| `tayfa.ps1` | PowerShell-версия скрипта запуска |
| `kill_all_agents.bat` | Остановка всех агентов (порт 8000 — **устарел**, нужен 8008) |
| `kill_all_agents.ps1` | PowerShell-версия остановки |
| `check_agents.py` | Мониторинг состояния агентов |

### 2.4 Создание ярлыков

| Файл | Назначение |
|------|------------|
| `create_shortcut.bat` | Создание ярлыка на рабочем столе (batch) |
| `create_shortcut.ps1` | Создание ярлыка (PowerShell) |
| `create_shortcut.py` | Создание ярлыка (Python) |
| `create_shortcut.vbs` | Создание ярлыка (VBScript) |

### 2.5 Папки

| Папка | Назначение |
|-------|------------|
| `static/` | Статические файлы веб-интерфейса (index.html, иконки) |
| `template_tayfa/` | **Пустой шаблон** — только структура папок без файлов |
| `logs/` | Логи выполнения (`executed_requests.jsonl`) |
| `venv/` | Виртуальное окружение Python |

### 2.6 Вспомогательные файлы

| Файл | Назначение |
|------|------------|
| `_task_boss.txt` | Временный файл для передачи задачи boss |

---

## 3. Директория Personel/ — Команда агентов

### 3.1 Структура верхнего уровня

```
Personel/
├── common/              # Общие ресурсы для всех агентов
├── Request/             # Входящие запросы на создание агентов
├── project/             # Рабочий проект (содержит актуальный kok/)
│
├── boss/                # Руководитель проекта
├── hr/                  # HR-менеджер
├── architect/           # Системный архитектор
├── developer_frontend/  # Frontend-разработчик
├── developer_backend/   # Backend-разработчик
├── devops/              # DevOps-инженер
└── qa_tester/           # QA-тестировщик
```

### 3.2 Папка common/ — Общие ресурсы

```
common/
├── task_manager.py      # CLI/API управления задачами и спринтами
├── employee_manager.py  # CLI/API управления реестром сотрудников
├── memory_manager.py    # Управление памятью агентов
├── tasks.json           # База данных задач и спринтов
├── employees.json       # Реестр сотрудников
├── Rules/               # Правила работы агентов
├── skills/              # Навыки (skills) агентов
└── __pycache__/         # Кэш Python (не коммитить)
```

#### 3.2.1 Файлы данных

| Файл | Назначение |
|------|------------|
| `tasks.json` | Хранит все задачи и спринты. Структура: `{tasks: [...], sprints: [...], next_id, next_sprint_id}` |
| `employees.json` | Реестр сотрудников. Структура: `{employees: {name: {role, created_at}}}` |

#### 3.2.2 Менеджеры (CLI + API)

| Файл | Команды CLI | Назначение |
|------|-------------|------------|
| `task_manager.py` | `create`, `list`, `get`, `status`, `result`, `backlog`, `create-sprint`, `sprints`, `sprint` | Полный цикл управления задачами |
| `employee_manager.py` | `list`, `register`, `remove`, `get` | Управление реестром сотрудников |
| `memory_manager.py` | — | Сохранение/загрузка памяти агента |

#### 3.2.3 Папка Rules/ — Правила работы

| Файл | Назначение |
|------|------------|
| `teamwork.md` | Правила командной работы: как агенты взаимодействуют, workflow задач |
| `employees.md` | Описание каждого сотрудника и когда к нему обращаться |
| `api.md` | Правила работы с API оркестратора |
| `skills.md` | Как использовать навыки (skills) |
| `agents-and-skills-guide.md` | Общий гайд по агентам и навыкам |
| `cursor-cli-agents.md` | Работа с Cursor CLI |

#### 3.2.4 Папка skills/ — Навыки агентов

```
skills/
├── project-decomposer/      # Декомпозиция проектов на задачи
│   ├── SKILL.md             # Инструкции навыка
│   ├── README.md            # Документация
│   ├── QUICKSTART.md        # Быстрый старт
│   ├── evals/               # Тесты
│   ├── examples/            # Примеры использования
│   └── templates/           # Шаблоны (roadmap.json, milestone-tasks.json)
│
└── team-role-analyzer/      # Анализ ролей в команде
    ├── SKILL.md
    ├── README.md
    ├── QUICKSTART.md
    ├── evals/
    ├── examples/
    └── templates/
```

### 3.3 Папка Request/ — Входящие запросы

Содержит JSON-файлы с запросами на создание новых агентов:

| Файл | Назначение |
|------|------------|
| `developer_frontend.json` | Запрос на создание frontend-разработчика |
| `developer_backend.json` | Запрос на создание backend-разработчика |
| `qa_tester.json` | Запрос на создание тестировщика |
| `expert_math_elementary.json` | Запрос на создание эксперта по математике |

### 3.4 Папка project/ — Рабочий проект

```
project/
├── .gitignore               # Игнорируемые файлы
├── .cursor_chats.json       # Привязка агентов к chat_id (Cursor)
├── docs/                    # Документация проекта
│   ├── sprint_functionality.md  # Описание функциональности
│   └── file_map.md          # Этот документ
└── kok/                     # Актуальная версия оркестратора!
```

---

## 4. Структура папки агента

Каждый агент имеет стандартную структуру папки:

```
<agent_name>/
├── prompt.md       # Системный промпт — главные инструкции агента
├── profile.md      # Профиль: роль, навыки, обязанности
├── notes.md        # Рабочие заметки агента
├── source.md       # Исходные данные, контекст
├── tasks.md        # Персональный список задач
├── memory.json     # Память агента (опционально)
├── income/         # Входящие задания от других агентов
├── done/           # Выполненные задания
└── request/        # Исходящие запросы к другим агентам
```

### 4.1 Описание файлов

| Файл | Обязательный | Назначение |
|------|--------------|------------|
| `prompt.md` | Да | Системный промпт — определяет поведение агента |
| `profile.md` | Да | Описание роли, навыков, зон ответственности |
| `notes.md` | Да | Рабочие заметки, история действий |
| `source.md` | Нет | Дополнительный контекст, исходные данные |
| `tasks.md` | Нет | Персональный backlog агента |
| `memory.json` | Нет | Сохранённая память (факты, решения) |

### 4.2 Описание папок

| Папка | Назначение |
|-------|------------|
| `income/` | Входящие задания в формате `.md` |
| `done/` | Архив выполненных заданий |
| `request/` | Исходящие запросы к другим агентам |

### 4.3 Особенности агентов

| Агент | Особенности структуры |
|-------|----------------------|
| `boss/` | Нет source.md, tasks.md, request/ |
| `hr/` | Содержит `create_employee.py` — скрипт создания сотрудников |
| `developer_backend/` | Содержит `memory.json` |
| Остальные | Стандартная структура |

---

## 5. Связи между компонентами

### 5.1 Диаграмма взаимодействия

```
┌──────────────────────────────────────────────────────────────────┐
│                         Пользователь                              │
└─────────────────────────────┬────────────────────────────────────┘
                              │ HTTP :8008
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                    project/kok/app.py                            │
│                    (FastAPI Orchestrator)                        │
│                                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐   │
│  │ /api/agents │  │ /api/tasks  │  │ /api/employees          │   │
│  └──────┬──────┘  └──────┬──────┘  └───────────┬─────────────┘   │
└─────────┼────────────────┼─────────────────────┼─────────────────┘
          │                │                     │
          ▼                ▼                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                       common/                                    │
│  ┌────────────────┐  ┌────────────────┐  ┌──────────────────┐   │
│  │ task_manager.py│  │employees.json  │  │employee_manager  │   │
│  │                │  │                │  │.py               │   │
│  │  tasks.json ◄──┼──┤ Реестр         │  │                  │   │
│  │  (задачи)      │  │ сотрудников    │  │ Регистрация/     │   │
│  │                │  │                │  │ удаление         │   │
│  └────────────────┘  └────────────────┘  └──────────────────┘   │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                        Rules/                               │  │
│  │  teamwork.md — как агенты взаимодействуют                  │  │
│  │  employees.md — кто за что отвечает                        │  │
│  └────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
          │
          │ Папки агентов
          ▼
┌─────────────────────────────────────────────────────────────────┐
│  boss/     hr/      architect/   dev_*    devops/    qa_tester/ │
│    │        │           │          │         │           │      │
│    └────────┴───────────┴──────────┴─────────┴───────────┘      │
│                         │                                        │
│              Каждый агент читает:                                │
│              • Свой prompt.md                                    │
│              • common/Rules/*                                    │
│              • common/tasks.json (через task_manager.py)        │
│              • income/*.md (входящие задания)                   │
│                                                                  │
│              Каждый агент пишет:                                 │
│              • notes.md (заметки)                                │
│              • done/*.md (результаты)                           │
│              • request/*.md (запросы другим агентам)            │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 Поток задачи

```
1. boss создаёт задачу
   │
   ▼
2. task_manager.py записывает в tasks.json
   │
   ▼
3. Оркестратор находит developer по полю "developer" задачи
   │
   ▼
4. Developer получает задание (income/ или API trigger)
   │
   ▼
5. Developer выполняет, обновляет статус через task_manager.py
   │
   ▼
6. Статус → "на_проверке", tester получает задание
   │
   ▼
7. Tester проверяет, пишет результат в done/
   │
   ▼
8. Статус → "выполнена"
```

### 5.3 Роли в задаче

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   customer   │────▶│  developer   │────▶│    tester    │
│  (заказчик)  │     │ (исполнитель)│     │ (проверяющий)│
│              │     │              │     │              │
│ Детализирует │     │  Выполняет   │     │  Проверяет   │
│ требования   │     │    задачу    │     │   результат  │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
   статус:              статус:              статус:
   "новая"             "в_работе"         "на_проверке"
                                                │
                                                ▼
                                           статус:
                                          "выполнена"
```

---

## 6. Ключевые JSON-файлы

### 6.1 tasks.json — структура

```json
{
  "tasks": [
    {
      "id": "T001",
      "title": "Название задачи",
      "description": "Описание",
      "status": "новая|в_работе|на_проверке|выполнена|отменена",
      "customer": "boss",
      "developer": "developer_frontend",
      "tester": "qa_tester",
      "result": "Результат выполнения",
      "sprint_id": "S001",
      "depends_on": ["T000"],
      "created_at": "2026-02-11T12:00:00",
      "updated_at": "2026-02-11T12:00:00"
    }
  ],
  "sprints": [
    {
      "id": "S001",
      "title": "Название спринта",
      "description": "Описание",
      "status": "активный|завершён",
      "created_by": "boss",
      "finalize_task_id": "T002",
      "created_at": "2026-02-11T12:00:00"
    }
  ],
  "next_id": 2,
  "next_sprint_id": 2
}
```

### 6.2 employees.json — структура

```json
{
  "employees": {
    "boss": {
      "role": "Руководитель проекта",
      "created_at": "2026-02-10"
    },
    "hr": {
      "role": "HR-менеджер",
      "created_at": "2026-02-10"
    },
    "architect": {
      "role": "Системный архитектор",
      "created_at": "2026-02-11"
    }
  }
}
```

### 6.3 projects.json — структура (в project/kok/)

```json
{
  "projects": [
    {
      "name": "Tayfa Development",
      "path": "/mnt/c/.../Personel",
      "created_at": "2026-02-11T12:00:00"
    }
  ],
  "current_project": "/mnt/c/.../Personel"
}
```

---

## 7. Критерии приёмки (чеклист)

- [x] Документ покрывает ВСЕ директории первого уровня
- [x] Для каждого ключевого файла указано назначение
- [x] Есть диаграмма связей (раздел 5)
- [x] Указаны пути относительно корня проекта
- [x] Описана структура JSON-файлов
- [x] Описан workflow задач
- [x] Описана стандартная структура папки агента
