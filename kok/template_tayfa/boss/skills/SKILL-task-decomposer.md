---
name: task-decomposer
description: "Декомпозирует сложные задачи на атомарные подзадачи для сотрудников Tayfa. Используй когда получаешь большую задачу, фичу или проект, который нужно разбить на части. Триггеры: 'разбей задачу', 'декомпозируй', 'спланируй работу', 'создай задачи для команды', или когда видишь задачу, которую один сотрудник не может выполнить за один раунд."
---

# Task Decomposer

Ты — boss Tayfa. Твоя задача — разбивать сложные задачи на атомарные подзадачи, которые сотрудники могут выполнить эффективно.

## Философия декомпозиции

Хорошая декомпозиция — это баланс между:
- **Атомарностью** — задача должна быть достаточно маленькой для одного раунда работы
- **Самодостаточностью** — задача должна иметь понятный результат
- **Тестируемостью** — должно быть ясно, как проверить выполнение

## Workflow

### 1. Анализ входной задачи

Когда получаешь задачу, определи:

- **Тип задачи**: фича, баг, рефакторинг, исследование, документация
- **Scope**: какие части системы затрагивает
- **Зависимости**: от чего зависит выполнение
- **Риски**: что может пойти не так

### 2. Декомпозиция по слоям

Разбивай сверху вниз:

```
Эпик (большая цель)
  └── Задача (конкретная фича/модуль)
       └── Подзадача (атомарное действие)
```

**Правила для подзадач:**
- Один сотрудник, один раунд работы
- Чёткие входные данные и ожидаемый результат
- Понятные критерии приёмки
- Зависимости явно указаны

### 3. Формат задачи для task_manager.py

Создавай задачи через `python .tayfa/common/task_manager.py create`:

```json
{
  "title": "Короткое, понятное название",
  "description": "Что нужно сделать и зачем",
  "instructions": "Пошаговые инструкции для исполнителя",
  "acceptance_criteria": [
    "Критерий 1: что должно работать",
    "Критерий 2: что должно быть проверено"
  ],
  "depends_on": ["T001", "T002"],
  "assignee_role": "developer_python | developer_frontend | qa_tester | ..."
}
```

### 4. Паттерны декомпозиции

**Для новой фичи:**
1. Исследование / дизайн (если нужно)
2. Создание структуры (файлы, модули)
3. Реализация core-логики
4. Интеграция с существующим кодом
5. Написание тестов
6. Код-ревью / рефакторинг

**Для бага:**
1. Воспроизведение и диагностика
2. Написание failing test
3. Исправление
4. Проверка что тест проходит
5. Регрессионное тестирование

**Для рефакторинга:**
1. Анализ текущего состояния
2. Дизайн нового решения
3. Создание новой структуры (параллельно старой)
4. Миграция по частям
5. Удаление старого кода
6. Тестирование

## Размер задачи

**Слишком большая задача (разбить!):**
- "Реализовать авторизацию"
- "Создать админ-панель"
- "Переписать модуль X"

**Хороший размер:**
- "Создать модель User с полями email, password_hash"
- "Написать endpoint POST /auth/login"
- "Добавить валидацию email в форму регистрации"

**Слишком мелкая (объединить!):**
- "Добавить поле name в модель"
- "Добавить поле email в модель"
→ Лучше: "Создать модель User со всеми полями"

## Зависимости

**Явные зависимости** — указывай в `depends_on`:
- Задача B использует код из задачи A
- Задача B тестирует функционал задачи A

**Неявные зависимости** — учитывай при планировании:
- Общие файлы (конфликты при merge)
- Общие концепции (нужно согласовать подход)

## Пример декомпозиции

**Входная задача:** "Добавить возможность экспорта отчётов в PDF"

**Декомпозиция:**

```
T001: Исследовать библиотеки для генерации PDF (developer_python)
      → Результат: файл docs/pdf-library-choice.md с рекомендацией

T002: Создать сервис PdfGenerator с базовой структурой (developer_python)
      → depends_on: T001
      → Результат: файл services/pdf_generator.py

T003: Реализовать шаблон отчёта в HTML/CSS (developer_frontend)
      → Результат: файл templates/report.html

T004: Интегрировать шаблон с PdfGenerator (developer_python)
      → depends_on: T002, T003
      → Результат: метод generate_report() работает

T005: Добавить endpoint GET /reports/{id}/pdf (developer_python)
      → depends_on: T004
      → Результат: API возвращает PDF файл

T006: Написать тесты для PdfGenerator (qa_tester)
      → depends_on: T004
      → Результат: тесты в tests/test_pdf_generator.py

T007: Добавить кнопку "Скачать PDF" в UI (developer_frontend)
      → depends_on: T005
      → Результат: кнопка работает, файл скачивается
```

## Чеклист перед созданием задач

- [ ] Каждая задача выполнима одним сотрудником за один раунд
- [ ] Критерии приёмки чёткие и проверяемые
- [ ] Зависимости указаны явно
- [ ] Нет циклических зависимостей
- [ ] Есть задачи на тестирование
- [ ] Задачи упорядочены логически (можно начинать работу)

## Антипаттерны

❌ **"Сделай по аналогии с X"** — сотрудник может не знать X
✅ Лучше: дай конкретные инструкции или ссылку на код

❌ **"Используй лучшие практики"** — слишком абстрактно
✅ Лучше: укажи конкретный паттерн или стандарт проекта

❌ **"Исправь если что-то не работает"** — неопределённый scope
✅ Лучше: опиши конкретно что должно работать

❌ **Задача без критериев приёмки**
✅ Всегда указывай как проверить что задача выполнена
