# Правила работы в команде

## Рабочая папка агентов

Все агенты работают в корне проекта (workdir). Из него видны:
- Файлы и папки проекта.
- `.tayfa/` — папка команды: common/, boss/, hr/, <имя>/.

## Где что хранить

- **Корень проекта** — **работа по проекту**: код, фронтенд/бэкенд, дизайн-макеты, контент продукта, документация. Все артефакты проекта здесь.
- **`.tayfa/`** — **коммуникация и учёт**: задачи, реестр сотрудников, правила, промпты и профили, входящие/исходящие задания.

---

## Система задач и спринтов

### Центральное хранилище

Все задачи и спринты — в **`.tayfa/common/tasks.json`**, управляются через **`.tayfa/common/task_manager.py`**. Оркестратор отображает их на доске задач.

**Не редактируй `tasks.json` вручную** — используй `task_manager.py`.

### Спринты

Спринт — группа задач, объединённых общей целью. **Все задачи должны быть привязаны к спринту.**

- Спринты создаёт **только boss**.
- При создании спринта автоматически создаётся задача **«Финализировать спринт»**, которая зависит от всех остальных задач спринта.
- В оркестраторе спринты отображаются списком (новые сверху, старые внизу). Каждый спринт раскрывается, и внутри — канбан-доска с задачами.

**Статусы спринта:** `активный` → `завершён`.

```bash
# Создать спринт
python .tayfa/common/task_manager.py create-sprint "Название спринта" "Описание"

# Список спринтов
python .tayfa/common/task_manager.py sprints

# Получить спринт
python .tayfa/common/task_manager.py sprint S001
```

### Статусы задач

| Статус | Описание |
|--------|----------|
| `новая` | Задача создана, ещё не начата |
| `в_работе` | Разработчик выполняет задачу |
| `на_проверке` | Тестировщик проверяет результат |
| `выполнена` | Задача завершена и принята |
| `отменена` | Задача отменена |

### Роли в задаче

Каждая задача имеет **3 исполнителей**:

| Роль | Что делает |
|------|-----------|
| **Заказчик (customer)** | При статусе «новая» → детализирует задачу, переводит в «в_работе» |
| **Разработчик (developer)** | При статусе «в_работе» → реализует, переводит в «на_проверке» |
| **Тестировщик (tester)** | При статусе «на_проверке» → проверяет, переводит в «выполнена» или возвращает в «в_работе» |

### Зависимости задач (depends_on)

У задачи может быть поле **`depends_on`** — список ID задач, от которых она зависит. Это означает, что задача не может быть начата, пока зависимости не выполнены.

- На доске задач зависимости отображаются с индикатором: ✓ (выполнена) или ● (ещё не выполнена).
- Задача **«Финализировать спринт»** автоматически зависит от всех задач спринта.

### Кто создаёт задачи

Задачи создаёт **только boss**:

```bash
# Одна задача (привязана к спринту S001)
python .tayfa/common/task_manager.py create "Заголовок" "Описание" \
  --customer boss --developer developer_frontend --tester qa_tester \
  --sprint S001

# Задача с зависимостями
python .tayfa/common/task_manager.py create "Заголовок" "Описание" \
  --customer boss --developer developer_frontend --tester qa_tester \
  --sprint S001 --depends-on T001 T002

# Бэклог (массовое создание)
python .tayfa/common/task_manager.py backlog backlog.json
```

### Рабочий процесс

```
Boss создаёт спринт → автоматически создаётся задача «Финализировать спринт»
Boss создаёт задачи в спринте → [новая]
   → Заказчик детализирует → [в_работе]
      → Разработчик выполняет → [на_проверке]
         → Тестировщик проверяет → [выполнена]
                                 ↘ [в_работе] (если проблемы)
Все задачи спринта выполнены → Финализировать спринт
```

На каждом этапе в оркестраторе нажимается кнопка — соответствующий агент получает промпт и выполняет работу.

### Как агент работает с задачей

1. Получает информацию: ID, заголовок, описание, роль, предыдущий результат, зависимости.
2. Выполняет работу.
3. Записывает результат:
   ```bash
   python .tayfa/common/task_manager.py result T001 "Описание результата"
   ```
4. Меняет статус:
   ```bash
   python .tayfa/common/task_manager.py status T001 <новый_статус>
   ```

### Просмотр задач

```bash
python .tayfa/common/task_manager.py list                    # все задачи
python .tayfa/common/task_manager.py list --status в_работе  # по статусу
python .tayfa/common/task_manager.py list --sprint S001      # задачи спринта
python .tayfa/common/task_manager.py get T001                # одна задача
```

---

## Единый реестр сотрудников

Источник правды — **`.tayfa/common/employees.json`**. Оркестратор показывает только зарегистрированных.

- Новые сотрудники — **только** через `python .tayfa/hr/create_employee.py <имя>`.
- Просмотр: `python .tayfa/common/employee_manager.py list`
- Изначально: `boss`, `hr`.

**Не редактируй `employees.json` вручную** — используй скрипты.

---

## Входящие задания — папка `income/`

У каждого сотрудника:

```
.tayfa/<имя>/income/    ← входящие задания и сообщения
.tayfa/<имя>/done/      ← выполненные (архив)
```

### Как это работает

1. Boss может положить доп. инструкции в `income/` исполнителя.
2. Агент проверяет `income/` и обрабатывает файлы.
3. После выполнения — переместить в `done/`.

### Формат файла-задания в income/

```markdown
# Задание

- **От**: <имя отправителя>
- **Дата**: <дата>
- **Тип**: задание | сообщение | вопрос

## Цель

<Что нужно сделать>

## Описание

<Подробности>

## Критерии приёмки

- [ ] Критерий 1
- Результат положить: <путь>
```

Имя файла: `<от_кого>_<описание>.md`.

---

## Правила

- **Задачи** — через `.tayfa/common/task_manager.py`. Все задачи в `.tayfa/common/tasks.json`.
- **Все задачи привязаны к спринту** — при создании указывай `--sprint S001`.
- **Спринты** — через `.tayfa/common/task_manager.py create-sprint`.
- **Сотрудники** — через `.tayfa/common/employee_manager.py` и `.tayfa/hr/create_employee.py`.
- Файлы из `income/` — перемещать в `done/`, не удалять.
- Артефакты проекта — в корне проекта; коммуникация — в `.tayfa/`.

---

## Пример рабочего цикла

```
1. Boss создаёт спринт:
   python .tayfa/common/task_manager.py create-sprint "Парсинг API" "Реализовать парсер внешнего API"
   → Создан S001, автоматически создана задача «Финализировать спринт»

2. Boss создаёт задачи в спринте:
   python .tayfa/common/task_manager.py create "Написать парсер" "Парсер для API" \
     --customer boss --developer developer_python --tester qa_tester --sprint S001
   → Создана T002, привязана к S001

3. Оркестратор: кнопка «Заказчик детализирует» → boss:
   python .tayfa/common/task_manager.py result T002 "Подробные требования..."
   python .tayfa/common/task_manager.py status T002 в_работе

4. Оркестратор: кнопка «Разработчик выполняет» → developer_python:
   python .tayfa/common/task_manager.py result T002 "Готово, src/parser.py"
   python .tayfa/common/task_manager.py status T002 на_проверке

5. Оркестратор: кнопка «Тестировщик проверяет» → qa_tester:
   python .tayfa/common/task_manager.py result T002 "Всё работает"
   python .tayfa/common/task_manager.py status T002 выполнена

6. Все задачи выполнены → финализируем спринт через задачу «Финализировать спринт»
```
